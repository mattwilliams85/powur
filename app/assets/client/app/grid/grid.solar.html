<div class="pw-grid solar">
  <div class="accordion" layout="row" layout-align="space-between-center">
    <span class="toggle-wrapper" ng-click="hideInsight = !hideInsight">
      <span class="toggle" ng-class="{'closed': hideInsight }"></span>
      GRID <b>SUMMARY</b>
    </span>
    <md-menu md-position-mode="target-right target" md-offset="0 10">
      <div ng-click="$mdOpenMenu($event)" layout="row" layout-align="center center">
        {{ grid.dateFilterLabel }}
        <i class="material-icons" ng-click="$mdOpenMenu($event)">date_range</i>
      </div>
      <md-menu-content class="filter-menu" width="4">
        <md-menu-item class="header"><span>SELECT <b>DATE RANGE</b></span></md-menu-item>
        <md-menu-item ng-repeat="d in [7, 30, 60, 0]">
          <md-button ng-click="grid.filter('days', d)" aria-label="{{d}}">
            <div layout="row">
              <p ng-if="d" flex>In last {{ d }} days</p>
              <p ng-if="!d" flex>Lifetime (all)</p>
            </div>
          </md-button>
        </md-menu-item>
      </md-menu-content>
    </md-menu>
  </div>

  <div class="insight" layout="row" ng-hide="hideInsight">
    <div layout="column" layout-align="space-around" flex="20">
      <div class="label">LEADS</div>
      <div class="count" layout="row" layout-align="center center">
        <i class="material-icons">assignment</i>
        {{ grid.insight.leads }}
      </div>
    </div>
    <div layout="column" layout-align="space-around" flex="20">
      <div class="label">QUALIFIED</div>
      <div class="count" layout="row" layout-align="center center">
        <i class="material-icons">assignment_turned_in</i>
        {{ grid.insight.proposals }}
      </div>
    </div>
    <div layout="column" layout-align="space-around" flex="20">
      <div class="label">CLOSED WON</div>
      <div class="count" layout="row" layout-align="center center">
        <i class="material-icons">thumb_up</i>
        {{ grid.insight.closed }}
      </div>
    </div>
    <div layout="column" layout-align="space-around" flex="20">
      <div class="label">CONTRACTS</div>
      <div class="count" layout="row" layout-align="center center">
        <i class="material-icons">import_contacts</i>
        {{ grid.insight.contracts }}
      </div>
    </div>
    <div layout="column" layout-align="space-around" flex="20">
      <div class="label">INSTALLS</div>
      <div class="count" layout="row" layout-align="center center">
        <i class="material-icons">home</i>
        {{ grid.insight.installs }}
      </div>
    </div>
  </div>

  <div class="accordion" layout="row" layout-align="space-between center">
    <span class="toggle-wrapper" ng-click="hideGeo = !hideGeo">
      <span class="toggle" ng-class="{'closed': hideGeo }"></span>
      GRID <b>GEO</b>
    </span>

    <md-menu md-position-mode="target-right target" md-offset="0 10">
      <div ng-click="$mdOpenMenu($event)" layout="row" layout-align="center center">
        {{ grid.dateFilterLabel }}
        <i class="material-icons" ng-click="$mdOpenMenu($event)">date_range</i>
      </div>
      <md-menu-content class="filter-menu" width="4">
        <md-menu-item class="header"><span>SELECT <b>DATE RANGE</b></span></md-menu-item>
        <md-menu-item ng-repeat="d in [7, 30, 60, 0]">
          <md-button ng-click="grid.filter('days', d)" aria-label="{{d}}">
            <div layout="row">
              <p ng-if="d" flex>In last {{ d }} days</p>
              <p ng-if="!d" flex>Lifetime (all)</p>
            </div>
          </md-button>
        </md-menu-item>
      </md-menu-content>
    </md-menu>
  </div>

  <div class="summary geo" ng-hide="hideGeo">
    <div hide-gt-sm class="header-row" layout="row" layout-align="start center">
      <span class="label left" flex="50">TERRITORY</span>
      <span class="label" flex="25">GRID SIZE</span>
      <span class="label" flex="25">PARTNERS</span>
    </div>
    <div hide-gt-sm ng-repeat="i in [1,2,3,4,5,6]">
      <div class="grid-row" layout="row" layout-align="start center">
        <span class="left" flex="50" layout="row" layout-align="start center">
          <div class="state"></div>
          CALIFORNIA
        </span>
        <span class="count" flex="25">4</span>
        <span class="count" flex="25">12</span>
      </div>
      <md-divider></md-divider>
    </div>
    <div class="co2">
      <span></span>
      <span>You have sequestered <b>1,499 TONS</b> of CO<sup>2</sup></span>
    </div>
  </div>

  <div class="accordion" layout="row" layout-align="space-between-center" >
    <span class="toggle-wrapper" ng-click="hideGrid = !hideGrid">
      <span class="toggle" ng-class="{'closed': hideGrid }"></span>
      GRID <b>LEADS</b>
    </span>
    <div layout="row" layout-align="center center">
      <i class="material-icons" ng-class="{ 'active': search }" ng-click="search = !search">search</i>
      <form ng-submit="grid.filter('search',grid.searchQuery, null); search = false" novalidate autocomplete="off">
        <input ng-model="grid.searchQuery" ng-class="{ 'collapsed': !search }" focus-if="search" ng-blur="search = false" type="text" class="search" placeholder="SEARCH" autofocus>
      </form>

      <md-menu md-position-mode="target-right target" md-offset="0 10">
        <i class="material-icons" ng-click="$mdOpenMenu($event)">people</i>
        <md-menu-content class="filter-menu" width="4">
          <md-menu-item class="header"><span>SELECT <b>GROUP</b></span></md-menu-item>
          <md-menu-item>
            <md-button ng-click="grid.filter('group', null, 'user-team_leads');">
              <div layout="row">
                <p flex>Grid Leads (all)</p>
              </div>
            </md-button>
          </md-menu-item>
          <md-menu-item>
            <md-button ng-click="grid.filter('group', 'personal_leads', 'user-leads');">
              <div layout="row">
                <p flex>Personal leads</p>
              </div>
            </md-button>
          </md-menu-item>
        </md-menu-content>
      </md-menu>

      <md-menu md-position-mode="target-right target" md-offset="0 10">
        <i class="material-icons" ng-click="$mdOpenMenu($event)">filter_list</i>
        <md-menu-content class="filter-menu rigid" width="5">
          <md-menu-item class="header"><span>LEAD PHASE <b>FILTER</b></span></md-menu-item>
          <div class="filter-header" layout="row">
            <div ng-class="{ 'active': !grid.phaseFilter }" ng-click="grid.phaseFilter = null; grid.tabBar($event)" md-prevent-menu-close="md-prevent-menu-close" flex="25" class="tab">ALL
             <div class="md-ripple-container"></div>
            </div>
            <div ng-class="{ 'active': grid.phaseFilter === 'pending' }" ng-click="grid.phaseFilter = 'pending'; grid.tabBar($event)" md-prevent-menu-close="md-prevent-menu-close" flex="35" class="tab">PENDING</div>
            <div ng-class="{ 'active': grid.phaseFilter === 'submitted' }" ng-click="grid.phaseFilter = 'submitted'; grid.tabBar($event)" md-prevent-menu-close="md-prevent-menu-close" flex="40" class="tab">SUBMITTED</div>
            <md-ink-bar class="md-secondary"
                        style="left:{{ grid.barLeft }}px;right:{{ grid.barRight }}px"
                        ng-class="{ 'md-right': grid.barLeft < grid.barRight, 'md-left': grid.barLeft >= grid.barRight || !grid.barLeft }">
            </md-ink-bar>
          </div>
          <div class="filter-box">
            <md-radio-group ng-model="grid.radio">
              <div ng-hide="grid.phaseFilter" ng-click="grid.filter('all', null, null)"ng-show="grid.phaseFilter === 'pending'" ng-model="grid.activeFilters['all']">
                <md-radio-button ng-value="" aria-label="{{ f.label }}">
                       Leads (all)
                </md-radio-button>
              </div>
              <div ng-show="grid.phaseFilter === 'pending'" layout="column" layout-align="center start">
                <md-radio-button ng-click="grid.filter('data_status', val, 'not_submitted')" ng-repeat="val in grid.leads.properties.filters.options['data_status']" ng-value="val" aria-label="{{ val }}" >
                       {{ val | humanizeString }}
                </md-radio-button>
              </div>
              <div ng-show="grid.phaseFilter === 'submitted'" layout="row" layout-align="start center" class="flex-wrap">
                <md-radio-button ng-click="grid.filter('sales_status', val, 'submitted');"  ng-repeat="val in grid.leads.properties.filters.options['sales_status']" ng-value="val" aria-label="{{ val }}" >
                       {{ val | humanizeString }}
                </md-radio-button>
              </div>
            </md-radio-group>
          </div>
        </md-menu-content>
      </md-menu>

      <md-menu md-position-mode="target-right target" md-offset="0 10">
        <i class="material-icons" ng-click="$mdOpenMenu($event)">date_range</i>
        <md-menu-content class="filter-menu" width="4">
          <md-menu-item class="header"><span>SELECT <b>DATE RANGE</b></span></md-menu-item>
          <md-menu-item ng-repeat="d in [7, 30, 60, 0]">
            <md-button ng-click="grid.filter('days', d)" aria-label="{{d}}">
              <div layout="row">
                <p ng-if="d" flex>In last {{ d }} days</p>
                <p ng-if="!d" flex>Lifetime (all)</p>
              </div>
            </md-button>
          </md-menu-item>
        </md-menu-content>
      </md-menu>
    </div>
  </div>

  <div class="grid" ng-hide="hideGrid" layout="column" layout-align="center center">
    <div class="summary" layout="column">
      <div layout="row" class="chips flex-wrap">
        <div class="chip" ng-repeat="c in grid.activeFilters" layout="row" layout-align="center center">
          <span ng-hide="c.name === 'days'">{{c.label | humanizeString}}</span>
          <span ng-show="c.name === 'days'">Last {{c.label}} days</span>
          <i class="material-icons" ng-click="grid.removeFilter(c);">close</i>
        </div>
      </div>
      <div class="grid-row new" layout="row">
        <div flex="50" flex-gt-md="25"  layout="row" layout-align="start center" ng-click="grid.addLead($event)">
          <md-button class="md-fab md-primary" layout-align="center center" layout="row">
            <i class="material-icons">add</i>
          </md-button>
          <div class="detail">
            <div class="uppercase text-xl">CREATE A <b>LEAD</b></div>
          </div>
        </div>
      </div>
      <div ng-if="grid.leads.entities.length" class="header-row" layout="row" layout-align="center center">
        <span class="label left" flex="50" flex-gt-sm="25">CONTACT INFO</span>
        <span class="label left" flex="50" flex-gt-sm="25">PROGRESS</span>
        <span class="label left" hide show-gt-sm flex="25">LEAD OWNER</span>
        <span class="label left" hide show-gt-sm flex="25">POWUR MOVE</span>
      </div>
      <div class="grid-row-wrap" ng-repeat="lead in grid.leads.entities">
        <div class="grid-row" layout="row" ng-click="grid.showLead($event, lead)">
          <!-- COLUMN #contact -->
          <div class="left" flex="50" flex-gt-md="25"  layout="row" layout-align="start center">
            <div class="circle" layout-align="center center" layout="row">
              <span>{{ lead.properties.first_name[0] }}{{ lead.properties.last_name[0] }}</span>
            </div>
            <div class="detail">
              <div class="uppercase text-lg">{{ lead.properties.first_name }} <b>{{ lead.properties.last_name }}</b></div>
              <div class="uppercase text-sm">{{ lead.properties.city }}<span ng-if="lead.properties.state">, {{ lead.properties.state }}</span></div>
            </div>
          </div>
          <!-- COLUMN #progress -->
          <div ng-if="!lead.properties.submitted_at" class="uppercase right" flex="50" flex-gt-md="25"  layout="row" layout-align="start center">
            <i class="material-icons {{ grid.leadStatus(lead) }}">{{ grid.iconStatus(lead) }}</i>
            <div class="uppercase text-sm">
              Invitation {{ grid.leadStatus(lead) | humanizeString }}
            </div>
          </div>
          <div ng-if="lead.properties.stage > 4 && lead.properties.submitted_at" class="uppercase right" flex="50" flex-gt-md="25"  layout="column" layout-align="center center">
            <i class="material-icons {{ grid.leadStatus(lead) }}">{{ grid.iconStatus(lead) }}</i>
            <div class="uppercase text-sm">
              Lead {{ grid.stage[lead.properties.stage] | humanizeString }}
            </div>
          </div>
          <div ng-if="lead.properties.data_status === 'submitted' && lead.properties.stage < 5" class="uppercase right" flex="50" flex-gt-md="25"  layout="column" layout-align="center start">
            <div layout="row" layout-align="space-between" class="progress-bar">
              <div class="bar"></div>
              <div class="bar overlay" style="width:{{ lead.properties.stage * 20 }}%">
                <div class="bar animated stage-{{ lead.properties.stage }}"></div>
              </div>
              <div layout="column" layout-align="center center" flex="20">
                <div class="node-wrap">
                  <div class="node"></div>
                  <div class="highlight stage-0" ng-class="{ 'active': lead.properties.stage  >= 0 }"></div>
                </div>
              </div>
              <div layout="column" layout-align="center center" flex="20">
                <div class="node-wrap">
                  <div class="node"></div>
                  <div class="highlight stage-1" ng-class="{ 'active': lead.properties.stage  >= 1 }"></div>
                </div>
              </div>
              <div layout="column" layout-align="center center" flex="20">
                <div class="node-wrap">
                  <div class="node"></div>
                  <div class="highlight stage-2" ng-class="{ 'active': lead.properties.stage  >= 2 }"></div>
                </div>
              </div>
              <div layout="column" layout-align="center center" flex="20">
                <div class="node-wrap">
                  <div class="node"></div>
                  <div class="highlight stage-3" ng-class="{ 'active': lead.properties.stage  >= 3 }"></div>
                </div>
              </div>
              <div layout="column" layout-align="center center" flex="20">
                <div class="node-wrap">
                  <div class="node"></div>
                  <div class="highlight stage-4" ng-class="{ 'active': lead.properties.stage  >= 4 }"></div>
                </div>
              </div>
            </div>
            <div class="uppercase text-sm progress-detail">{{ grid.stage[lead.properties.stage] }}</div>
          </div>
          <!-- COLUMN #owner -->
          <div class="left" flex="50" flex-gt-md="25" hide show-gt-sm layout="row" layout-align="start center">
            <div class="circle" layout-align="center center" layout="row">
              <img ng-src="{{ lead.properties.owner.avatar.thumb || grid.defaultAvatar }}">
            </div>
            <div class="detail">
              <div class="uppercase text-lg">{{ lead.properties.owner.first_name }} <b>{{ lead.properties.owner.last_name }}</b></div>
              <div class="uppercase text-sm">{{ lead.properties.owner.email }}</div>
              <div class="text-sm">{{ lead.properties.owner.phone }}</div>
            </div>
          </div>
          <!-- COLUMN #move -->
          <div class="left" flex="50" flex-gt-md="25" hide show-gt-sm layout="row" layout-align="start center">
            <span class="text-sm">{{ lead.properties.action_copy || '---' }}</span>
          </div>
        </div>
        <md-divider hide show-gt-sm></md-divider>
      </div>
    </div>
    <div ng-show="!grid.leads.entities.length" layout-padding><i>No Results Found</i></div>
    <section ng-if="grid.leads.properties.paging.current_page < grid.leads.properties.paging.page_count">
      <md-button ng-click="grid.loadMore()" class="load-more">Load More</md-button>
    </section>
  </div>
</div>
