'use strict';

function PromoCtrl($scope, $location, $timeout, $interval, $window, $anchorScroll) {
  $scope.redirectToDashboardIfSignedIn();
  $scope.removePiler();

  $scope.isMenuActive = false;
  $scope.hideMenuClick = function() {
    $scope.isMenuActive = false;
  };
  $scope.showMenuClick = function() {
    $scope.isMenuActive = true;
  };

  $scope.setupPromoSlider = function(slides) {
    $scope.promoSlides = slides;
    $scope.currentSlide = 0;
    $scope.sliderStop = $interval(function() {
      if ($scope.currentSlide >= $scope.promoSlides.length - 1) {
        $scope.currentSlide = 0;
      } else {
        $scope.currentSlide += 1;
      }
    }, 6000);
  };

  $scope.animateArrow = function(id){
    var pilerTimer = $timeout(function() {
      $(id).animate({
        bottom: "3em"
      }, 500, "easeOutBounce" );
    }, 3000);

    $scope.$on('$locationChangeStart', function() {
      $timeout.cancel(pilerTimer);
    });
  }

  $scope.stopSlideShowOn = function(slide) {
    if (slide === parseInt(slide, 10)) { // check if integer
      $scope.currentSlide = slide;
    } else {
      $scope.currentSlide = $scope.promoSlides.indexOf(slide);
    }
    $interval.cancel($scope.sliderStop);
    $scope.sliderStop = undefined;
  };

  // $scope.promoSlides = [];

  $scope.energyPromoSlides = [
    {
      images: [
        'http://lorempixel.com/200/200/nature/1/',
        'http://lorempixel.com/200/200/nature/2/',
        '<%=asset_url("promo/slide-show-item.jpg") %>'
      ],
      text: 'Lock in a low rate on your electricity for the next 20 years, effectively guaranteeing no more price increases, or inflation costs for energy!'
    },
    {
      images: [
        'http://lorempixel.com/200/200/nature/3/',
        'http://lorempixel.com/200/200/nature/4/',
        '<%=asset_url("promo/slide-show-item.jpg") %>'
      ],
      text: 'Lock in a low rate on your electricity for the next 20 years, effectively guaranteeing no more price increases, or inflation costs for energy!'
    },
    {
      images: [
        'http://lorempixel.com/200/200/nature/5/',
        'http://lorempixel.com/200/200/nature/6/',
        '<%=asset_url("promo/slide-show-item.jpg") %>'
      ],
      text: 'Lock in a low rate on your electricity for the next 20 years, effectively guaranteeing no more price increases, or inflation costs for energy!'
    }
  ];

  $scope.directSalePromoSlides = [
    {
      images: [
        'http://lorempixel.com/200/200/nature/1/',
        'http://lorempixel.com/200/200/nature/2/',
        'http://lorempixel.com/200/200/nature/9/'
      ],
      text: 'There is no industry as good at spreading products via word of mouth as ours.  Despite the often misunderstood nature of direct sales, the numbers don’t lie.  Direct sales has the potential to create millions of solar customers over the next decade… and generate BILLIONS in wealth for those who do.'
    },
    {
      images: [
        'http://lorempixel.com/200/200/nature/3/',
        'http://lorempixel.com/200/200/nature/4/',
        'http://lorempixel.com/200/200/nature/5/'
      ],
      text: 'There is no industry as good at spreading products via word of mouth as ours.  Despite the often misunderstood nature of direct sales, the numbers don’t lie.  Direct sales has the potential to create millions of solar customers over the next decade… and generate BILLIONS in wealth for those who do.'
    },
    {
      images: [
        'http://lorempixel.com/200/200/nature/6/',
        'http://lorempixel.com/200/200/nature/7/',
        'http://lorempixel.com/200/200/nature/8/'
      ],
      text: 'There is no industry as good at spreading products via word of mouth as ours.  Despite the often misunderstood nature of direct sales, the numbers don’t lie.  Direct sales has the potential to create millions of solar customers over the next decade… and generate BILLIONS in wealth for those who do.'
    }
  ];

  this.init($scope, $location, $timeout, $interval, $anchorScroll);
  this.fetch($scope, $interval, $timeout, $anchorScroll, $location);
}


PromoCtrl.prototype.init = function($scope, $location, $timeout, $interval, $anchorScroll) {
  $scope.$watch('slider', function(newValue) {
    if (newValue === '1') {
      $('.image-2').animate({opacity:'1'},200);
      $('.image-1').animate({opacity:'0.3'},200);
      $timeout(function() {
        if ($location.path() === '/create-energy') {
          $.fn.pagepiling.moveSectionDown();
        }
        $scope.gotoAnchor('on_slider_move');
      }, 200);
    } else {
      $('.image-2').animate({opacity:'0.3'},200);
      $('.image-1').animate({opacity:'1'},200);
    }
  });

  // Setting mode based on the url
  $scope.mode = '';
  if (/\/create-wealth$/.test($location.path())) return $scope.mode = 'create-wealth';
  if (/\/create-energy$/.test($location.path())) return $scope.mode = 'create-energy';
  if (/\/why-solar$/.test($location.path())) return $scope.mode = 'why-solar';
  if (/\/why-you$/.test($location.path())) return $scope.mode = 'why-you';
  if (/\/why-powur$/.test($location.path())) return $scope.mode = 'why-powur';
  if (/\/why-direct-selling$/.test($location.path())) return $scope.mode = 'why-direct-selling';
  if (/\/our-origin$/.test($location.path())) return $scope.mode = 'our-origin';
  if (/\/our-team$/.test($location.path())) return $scope.mode = 'our-team';
  if (/\/our-dna$/.test($location.path())) return $scope.mode = 'our-dna';
};


PromoCtrl.prototype.fetch = function($scope, $interval, $timeout, $anchorScroll, $location) {
  if ($scope.mode === 'create-wealth') {
    $(window).on('beforeunload', function() {
        $(window).scrollTop(0);
    });
    $('body').addClass('no-scroll')
    $scope.setupInvertHeader();
    // Clock
    $scope.minTime = new Date(2000, 1, 1, 0, 0, 0, 0).valueOf();
    // Max time is 3 minutes
    $scope.maxTime = new Date(2000, 1, 1, 0, 0, 0, 0).valueOf() + (1000 * 60 * 3);
    $scope.solarTime = $scope.maxTime;
    $scope.solarTimerSeconds = '00';
    $scope.solarTimerMinutes = '03';
    $scope.solarTimerHours = '00';
    $scope.solarTimerPeople = 0;
    var timeStrings;
    $scope.solarTimerStop = $interval(function() {
      $scope.solarTime -= 1000;
      timeStrings = new Date($scope.solarTime).toTimeString().split(':');
      $scope.solarTimerHours = timeStrings[0];
      $scope.solarTimerMinutes = timeStrings[1];
      $scope.solarTimerSeconds = /^[\d]{2}/.exec(timeStrings[2])[0];
      if ($scope.solarTime === $scope.minTime) {
        $scope.solarTimerPeople += 1;
        $scope.solarTime = $scope.maxTime;
      }
    }, 1000);
  } else if ($scope.mode === 'create-energy') {
    $scope.animateArrow('#arrow_1')
    $scope.readyPiler();
    $scope.setupPromoSlider($scope.energyPromoSlides);
  } else if ($scope.mode === 'why-solar') {
    $scope.animateArrow('#arrow_1')
    $scope.readyPiler();
  } else if ($scope.mode === 'why-powur') {
    $scope.readyPiler();
  } else if ($scope.mode === 'why-you') {
    $scope.animateArrow('#arrow_1')
    $scope.readyPiler();

    $scope.currentSlide = 0;
    $timeout(function() {
      $scope.currentSlide += 1;
      $scope.sliderStop = $interval(function() {
        if ($scope.currentSlide >= 3) { $scope.animateArrow('#arrow_2') }
        if ($scope.currentSlide >= 4) {
          $scope.currentSlide = 0;
        } else {
          $scope.currentSlide += 1;
        }
      }, 5000);
    }, 500);
  } else if ($scope.mode === 'why-direct-selling') {
    $scope.animateArrow('#arrow_1')
    $scope.readyPiler();
    $scope.setupPromoSlider($scope.directSalePromoSlides);
  } else if ($scope.mode === 'our-origin') {
    $scope.setupInvertHeader();
  } else if ($scope.mode === 'our-dna') {
    $scope.setupInvertHeader();
  } else if ($scope.mode === 'our-team') {
    $scope.faces = [
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/jb.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/2.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/3.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/4.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/5.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/6.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/7.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Rick Hou',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/rh.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      },
      {
        name: 'Jonathan Budd',
        title: 'Founder/CEO',
        image: "<%=asset_path('promo/people/9.jpg') %>",
        details: 'Robert has 25 years of success experience in direct sales, solar and senior management.  He is uniquely qualified to lead Sunstand’s sales Division as the company sets course to bring solar energy to the masses.  He earned “top 10” status in a number of direct selling companies over the years, including INC, Magazine’s 1996 “fastest growing company in the U.S.”  He also served as president of the marketing division for Incomnet Communications where he engineered a two-year turnaround strategy that resulted in the company’s shift from losing 30,000 customers a month to gaining 5,000 a month. From 2006-2010, Robert was president of the marketing division of Citizenre where he built a sales division comprising many talented leaders and broke records in the renewable energy space, signing more than 38,000 customer contracts.',
        showDetails: false
      }
    ];
  }
};


PromoCtrl.$inject = ['$scope', '$location', '$timeout', '$interval', '$window', '$anchorScroll'];
sunstandControllers.controller('PromoCtrl', PromoCtrl);
