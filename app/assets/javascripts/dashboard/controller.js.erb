;(function() {
  'use strict';

  function DashboardCtrl($scope, $location, UserProfile) {
    $scope.redirectUnlessSignedIn();

    // Fix for scope inheritance issues (relating to Proposals search/sort):
    $scope.customerSection = {};
    // http://stackoverflow.com/questions/11412410/angularjs-losing-scope-when-using-ng-include

    UserProfile.get().then(function(user) {
      $scope.currentUser = user;
      if (user && user.require_enrollment) {
        $location.path('/university');
        $scope.showModal($scope.enrollmentRequirementMessage);
        return;
      }
      $scope.goals = { personalPercent: 100, groupPercent: 20, badge: '<%= image_path("badges/rank0.png") %>' };
      $scope.news = [ {text: 'Solar Power is the energy of the future.', date: '3/18/2015'},
                      {text: 'Did you know that in one single day, the sun sends 15,000 times as much energy to the Earth as we consume worldwide on a daily basis?', date: '3/15/2015'},
                      {text: 'The solar revolution is upon us.', date: '3/12/2015'},
                      {text: 'The future of the planet is in our hands.', date: '3/9/2015'}];
      $scope.moreNewsItems = true;
    });
  }

  DashboardCtrl.$inject = ['$scope', '$location', 'UserProfile'];
  angular.module('powurApp').controller('DashboardCtrl', DashboardCtrl);

})();
