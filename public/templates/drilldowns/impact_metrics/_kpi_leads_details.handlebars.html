<div class="arrow">
</div>

<h1></h1>
<div class="drilldown_content">
  <div id="kpi_environment_detail" class="object_detail">
    <div class="object_detail_content">
      <div class="object_detail_content_section summary">
        <h4>Current Progress</h4>
        <a class="return_to_team" style="z-index:99;margin:auto;display:block;height:30px; display:none; float:left; font-size:14px; text-transform:uppercase;">Return To Team Details</a>
        <span class="subtext progress_description" style="clear:both;">
        Today: 34 Quotes, 22 Sales <br>
        This Week: 78 Quotes, 45 Sales
        </span>
        <script>
          //bringing in current user's downline on the left side of KPIs (andrew)

          function populateContributors() {
            var _contributors = $(".contributors");
            _contributors.html("");

            _data.team.entities.forEach(function(member) {
              _ajax({
                _ajaxType: "get",
                _url: "/u/users/" + member.properties.id + "/downline",
                _callback: function(data, text) {
                  member.properties.downline_count = data.entities.length;
                  EyeCueLab.UX.getTemplate("/templates/_kpi_quote_team_thumbnail.handlebars.html", member, undefined, function(html) {
                    _contributors.append(html);
                  });
                }
              });
            });
          }

          populateContributors();
        </script>
        <div class="contributors">
          
        </div>
      </div>

      <div class="object_detail_content_section" style="padding-left:20px;">
        <h4 id="graph_title">Full Genealogy Conversion History </h4>
        <canvas id="metricsChart" width="670" height="375" style="float:left;"></canvas>

        <div class="time_unit_nav">
          <i class="fa fa-chevron-left" style="color:#555;padding:5px; background:#ccc; border-radius:30px; height:15px;width:15px; line-height:18px;margin-right:10px;"></i> <span>Week 11/1 - 11/7</span> <i class="fa fa-chevron-right" style="color:#555; padding:5px; background:#ccc; border-radius:30px; height:15px;width:15px; line-height:18px; margin-left:10px;"></i>
        </div>

        <div style="width:150px; padding-left:50px;float:left;">
          <div class="time_scale">
            Time Scale:
            <br>
            <span class="active week">Week</span><span class="month">Month</span>
          </div>
          <br>
          <br style="clear:both;">
          <div class="legend">
            <div class="legend-item" id="user-legend"></div>
            <span id="selected_user" class="legend-text">Quotes</span>
          </div>
          <br>
          <div class="legend">
            <div class="legend-item" id="global-legend"></div>
            <span id="average" class="legend-text">Sales</span>
          </div>
          <br>
          <div class="legend hide">
            <div class="legend-item" id="top-performer"></div>
            <span id="performer" class="legend-text"></span>
          </div>

          <br>
        </div>
      </div>

    </div>
    <!-- end object detail content -->
  </div>
</div>


<style>
.snapshot {
  line-height: 14px;
}
.time_unit_nav {
  position: absolute;
  bottom: 10px;
  left: 370px;
  width: 630px;
  height: 30px;
  text-align: center;
}
.time_scale,
.snapshot,
.time_unit_nav {
  font-size: 12px;
  text-transform: uppercase;
}
.time_scale span {
  display: block;
  float: left;
  padding: 10px;
  border: 1px solid #ccc;
  width: 50px;
  text-align: center;
  margin-top: -5px;
  cursor: pointer;
}
.time_scale span:first-of-type {
  border-right: 0px;
}
.time_scale span.active {
  background: #ccc;
  color: #333;
  transition: all 1s;
}
.avatar {
  width: 70px;
  height: 70px;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  background-size: contain;
  float: left;
}
#avatar1 {
  background-image: url('https://avatars0.githubusercontent.com/u/5414273?v=3&s=460');
}
#avatar2 {
  background-image: url('https://avatars2.githubusercontent.com/u/8699048?v=3&s=460')
}
#avatar3 {
  background-image: url('https://avatars1.githubusercontent.com/u/5241140?v=3&s=460')
}
.subtext {
  font-size: 0.8em;
}
.info-box {
  display: inline-block;
  padding-top: 10px;
}
.info-text {
  padding: 2.5px 0 0 21px;
  float: left;
}
.light-text {
  color: #eee;
  font-size: 0.85em;
}
.legend-box {
  vertical-align: top;
  display: inline-block;
}
.legend {
  display;
  inline;
}
.legend-item {
  width: 25px;
  height: 20px;
  float: left;
  margin-top: 5px;
}
.legend-text {
  font-size: 0.8em;
  float: left;
  padding-left: 5px;
}
#user-legend {
  background-color: rgba(32, 194, 241, 1);
}
#global-legend {
  background-color: rgba(249, 166, 0, 1);
}
#top-performer {
  background-color: rgba(44, 148, 105, 1);
}
.hide {
  display: none;
}
h4 {
  height: 42px;
}
.object_detail_content_section.summary {
  width: 280px;
  padding-right: 25px;
  border-right: 1px solid rgba(100, 100, 100, 0.9);
}
.object_detail_content_section {
  width: 880px;
  float: left;
}
.graph {
  width: 1180px;
  height: 300px;
  float: left;
  font-size: 14px;
  color: #fff;
  text-align: center;
  padding-top: 20px;
  margin-right: 20px;
}
.contributors {
  padding-top: 15px;
  z-index: 5;
  display: inline-block;
}
.contributor {
  cursor: pointer;
  padding:0 15px;
  background-color:#535353;
}
.drilldown_content {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.return_to_team {
  cursor: pointer;
}
</style>

<script>
var _randomData = {}
_randomData.me = [];
_randomData.team = [];
_randomData.performer = [];
var _labels = [];
var topPerformers = [];
var currentlyViewing = "team";
var metricsData = {
  labels: _labels,
  datasets: [{
    label: "My First dataset",
    fillColor: "rgba(32, 194, 241,1)",
    highlightFill: "#5bd7f7",
    data: []
  }, {
    label: "My Second dataset",
    fillColor: "rgba(253, 180, 92, .9)",
    highlightFill: "#FFC870",
    data: []
  }]
};

generateData(7);
$.extend(metricsData.datasets[0].data, _randomData.me);
$.extend(metricsData.datasets[1].data, _randomData.team);


function generateData(days) {
  if (typeof days === "undefined") days = 7;

  for (i = 1; i <= days; i++) {
    _labels.push("11/" + i);
  }
  for (i = 1; i <= days; i++) {
    _randomData.me.push(Math.floor(Math.random() * 18 + 75));
    _randomData.team.push(Math.floor(Math.random() * 18 + 75));
  }

  ["John Doe", "Danny Smith", "Lisa Williams"].forEach(function(name) {
    var tempData1 = [];
    var tempData2 = [];

    for (i = 1; i <= days; i++) tempData1.push(Math.floor(Math.random() * 30 + 10));
    for (i = 1; i <= days; i++) tempData2.push(Math.floor(Math.random() * 30 + 10));

    topPerformers.push({
      name: name,
      data1: tempData1,
      data2: tempData2
    });
  });
}



var ctx = document.getElementById("metricsChart").getContext("2d");

var options = {

  //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
  scaleBeginAtZero: true,

  //Boolean - Whether grid lines are shown across the chart
  scaleShowGridLines: true,

  //String - Colour of the grid lines
  scaleGridLineColor: "rgba(255,255,255,.15)",
  scaleFontColor: "#fff",

  //Number - Width of the grid lines
  scaleGridLineWidth: 1,

  //Boolean - If there is a stroke on each bar
  barShowStroke: true,

  //Number - Pixel width of the bar stroke
  barStrokeWidth: 2,

  //Number - Spacing between each of the X value sets
  barValueSpacing: 5,

  //Number - Spacing between data sets within X values
  barDatasetSpacing: 1,

  scaleOverride: true,

  scaleFontSize: 13,

  // ** Required if scaleOverride is true **
  // Number - The number of steps in a hard coded scale
  scaleSteps: 12,
  // Number - The value jump in the hard coded scale
  scaleStepWidth: 12,
  // Number - The scale starting value
  scaleStartValue: 0,

  //String - A legend template
  legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

}

var myChart = new Chart(ctx).Line(metricsData, options);

$(".contributor")

  .velocity("transition.slideUpBigIn", {
    stagger: 200,
    duration: 600
  })
  .append("<hr style='border-color:rgba(255,255,255,.08);margin:5px 0 5px 0'> ")


$(".return_to_team").on("click", function(e) {
  $.extend(metricsData.datasets[0].data, _randomData.me);
  $.extend(metricsData.datasets[1].data, _randomData.team);
  myChart.destroy();
  myChart = new Chart(ctx).Line(metricsData, options);
  $("#graph_title").html("Full Genealogy Conversion History");
  $(".contributor").css("background", "none");
  $(".return_to_team").fadeOut();
  $(".progress_description").fadeIn();
  currentlyViewing = "team";

});

$(".time_scale .month").on("click", function() {
  _randomData.me.length = 0;
  _randomData.team.length = 0;
  _labels.length = 0;
  topPerformers.length = 0;
  metricsData.datasets[0].data.length = 0;
  metricsData.datasets[1].data.length = 0;

  generateData(30);

  if (currentlyViewing == "team") {
    $("#graph_title").html("Full Genealogy Conversion History");
    $.extend(metricsData.datasets[0].data, _randomData.me);
    $.extend(metricsData.datasets[1].data, _randomData.team);
  } else {
    $("#graph_title").html(topPerformers[_index].name + "'s Conversion History")
    $.extend(metricsData.datasets[0].data, topPerformers[_index].data1);
    $.extend(metricsData.datasets[1].data, topPerformers[_index].data2);
  }
  options.animationSteps = 20;
  myChart.destroy();
  myChart = new Chart(ctx).Line(metricsData, options);
  $(".time_unit_nav span").html("November, 2014")
  $(".time_scale .week").removeClass("active");
  $(this).addClass("active");
})

$(".time_scale .week").on("click", function() {
  _randomData.me.length = 0;
  _randomData.team.length = 0;
  _labels.length = 0;
  topPerformers.length = 0;
  metricsData.datasets[0].data.length = 0;
  metricsData.datasets[1].data.length = 0;

  generateData(7);

  if (currentlyViewing == "team") {
    $("#graph_title").html("Full Genealogy Conversion History");
    $.extend(metricsData.datasets[0].data, _randomData.me);
    $.extend(metricsData.datasets[1].data, _randomData.team);
  } else {
    $("#graph_title").html(topPerformers[_index].name + "'s Conversion History")
    $.extend(metricsData.datasets[0].data, topPerformers[_index].data1);
    $.extend(metricsData.datasets[1].data, topPerformers[_index].data2);
  }
  $.extend(metricsData.datasets[0].data, _randomData.me);
  $.extend(metricsData.datasets[1].data, _randomData.team);
  $.extend(metricsData.datasets[0].data, _randomData.me);
  $.extend(metricsData.datasets[1].data, _randomData.team);

  options.animationSteps = 20;
  myChart.destroy();
  myChart = new Chart(ctx).Line(metricsData, options);

  $(".time_unit_nav span").html("Week 11/1 - 11/7");
  $(".time_scale .month").removeClass("active");
  $(this).addClass("active");
})



$(".contributor").on("click", function(e) {

  e.preventDefault();
  e.stopPropagation();
  $(".return_to_team").fadeIn();
  _index=$(this).find(".avatar").attr("id").replace("avatar","")-1;
  $(".progress_description").hide();
  $('.contributor').each(function(){
    $(this).velocity({backgroundColor:"#545454"},100);
  })
  $(this).velocity({backgroundColor:"#454545"},100);
  $.extend(metricsData.datasets[0].data, topPerformers[_index].data1);
  $.extend(metricsData.datasets[1].data, topPerformers[_index].data2);
  currentlyViewing = "individuals";

  // metricsData.datasets[2].fillColor = "rgba(44,148,105,1)";
  // metricsData.datasets[2].highlightFill= "rgba(44,148,105,1)";

  options.animationSteps = 20;
  myChart.destroy();
  myChart = new Chart(ctx).Line(metricsData, options);
  $("#graph_title").html(topPerformers[_index].name + "'s Conversion History")
    // $("#performer").html(topPerformers[_index].name);
    // $(".legend").removeClass("hide");

});

function numberWithCommas(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
</script>
